<UserControl x:Class="Login_Sample.Views.RepairProgressView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Login_Sample.Views"
             xmlns:vm="clr-namespace:Login_Sample.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="450"
             d:DesignWidth="800"
             d:DataContext="{d:DesignInstance vm:RepairProgressViewModel}">
    <UserControl.Resources>
        <!-- 维修项目样式 -->
        <Style x:Key="RepairItemStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Margin" Value="2,2,2,2" />
            <Setter Property="Padding" Value="4,2,4,2" />
            <Setter Property="TextBlock.FontSize" Value="12" />
            <Setter Property="BorderThickness" Value="1" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="已完成">
                    <Setter Property="Background" Value="#D4EDDA" />
                    <Setter Property="BorderBrush" Value="#28A745" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="正在进行">
                    <Setter Property="Background" Value="#E3F2FD" />
                    <Setter Property="BorderBrush" Value="#17A2B8" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="待进行">
                    <Setter Property="Background" Value="#FFF3CD" />
                    <Setter Property="BorderBrush" Value="#FFC107" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- 维修状态样式 -->
        <Style x:Key="StatusBadgeStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="8,4,8,4" />
            <Setter Property="TextBlock.FontSize" Value="12" />
            <Setter Property="TextBlock.FontWeight" Value="Medium" />
            <Setter Property="TextBlock.Foreground" Value="White" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding RepairStatus}" Value="已完工">
                    <Setter Property="Background" Value="#28A745" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RepairStatus}" Value="正在进行">
                    <Setter Property="Background" Value="#17A2B8" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RepairStatus}" Value="待料">
                    <Setter Property="Background" Value="#FFC107" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RepairStatus}" Value="待诊断">
                    <Setter Property="Background" Value="#FFC107" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RepairStatus}" Value="已派工">
                    <Setter Property="Background" Value="#17A2B8" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RepairStatus}" Value="已领料">
                    <Setter Property="Background" Value="#17A2B8" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RepairStatus}" Value="开单">
                    <Setter Property="Background" Value="#6C757D" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <!-- 模块标题 -->
        <Grid Grid.Row="0" Background="#3498DB" Height="50">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="20" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Label Grid.Column="1" Content="维修进度" HorizontalAlignment="Left" VerticalAlignment="Center"
                   FontSize="20" FontWeight="Bold" Foreground="White" Margin="10,0,0,0"/>
        </Grid>
        
        <!-- 查询条件区域 -->
        <Grid Grid.Row="1" Margin="10,10,10,5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="1" />
            </Grid.RowDefinitions>
            <Border BorderThickness="1" BorderBrush="#E0E0E0" CornerRadius="5" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- 车牌号 -->
                    <Grid Grid.Column="0" Grid.Row="0" Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Label Content="车牌号：" Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Right" />
                        <TextBox Grid.Column="1" Text="{Binding LicensePlate, UpdateSourceTrigger=PropertyChanged}" Margin="5,0,0,0" Height="30" />
                    </Grid>
                    
                    <!-- 订单号 -->
                    <Grid Grid.Column="1" Grid.Row="0" Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Label Content="订单号：" Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Right" />
                        <TextBox Grid.Column="1" Text="{Binding OrderNumber, UpdateSourceTrigger=PropertyChanged}" Margin="5,0,0,0" Height="30" />
                    </Grid>
                    
                    <!-- 搜索按钮 -->
                    <Button Grid.Column="2" Grid.Row="0" Content="搜索" Command="{Binding SearchCommand}" 
                            Background="#3498DB" Foreground="White" Margin="5" Height="30" Width="80" HorizontalAlignment="Right" />
                    
                    <!-- 刷新按钮 -->
                    <Button Grid.Column="3" Grid.Row="0" Content="刷新" Command="{Binding RefreshCommand}" 
                            Background="#95A5A6" Foreground="White" Margin="5" Height="30" Width="80" HorizontalAlignment="Left" />
                </Grid>
            </Border>
            <Rectangle Grid.Row="1" Fill="#E0E0E0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />
        </Grid>
        
        <!-- 维修进度列表 -->
        <Grid Grid.Row="2" Margin="10,5,10,10">
            <Border BorderThickness="1" BorderBrush="#E0E0E0" CornerRadius="5">
                <ListView ItemsSource="{Binding RepairProgressItems}" Background="White">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border BorderThickness="0,0,0,1" BorderBrush="#E0E0E0" Padding="10">
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="150" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- 车牌号和车型 -->
                                    <StackPanel Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding LicensePlate}" FontSize="16" FontWeight="Bold" />
                                        <TextBlock Text="{Binding VehicleModel}" FontSize="12" Foreground="#6C757D" Margin="0,2,0,0" />
                                    </StackPanel>
                                    
                                    <!-- 客户信息 -->
                                    <StackPanel Grid.Column="1" Grid.Row="0" Grid.RowSpan="3" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding CustomerName}" FontSize="14" />
                                        <TextBlock Text="{Binding OrderNumber}" FontSize="12" Foreground="#6C757D" Margin="0,2,0,0" />
                                    </StackPanel>
                                    
                                    <!-- 接待时间 -->
                                    <StackPanel Grid.Column="2" Grid.Row="0" Grid.RowSpan="3" VerticalAlignment="Center">
                                        <TextBlock Text="接待时间" FontSize="12" Foreground="#6C757D" />
                                        <TextBlock Text="{Binding ReceptionDate, StringFormat='yyyy-MM-dd HH:mm'}" FontSize="12" />
                                    </StackPanel>
                                    
                                    <!-- 维修项目 -->
                                    <StackPanel Grid.Column="3" Grid.Row="0" Grid.RowSpan="3" Margin="10,0,10,0">
                                        <TextBlock Text="维修项目" FontSize="12" FontWeight="Medium" Margin="0,0,0,4" />
                                        <ItemsControl ItemsSource="{Binding RepairItems}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel Orientation="Horizontal" />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Style="{StaticResource RepairItemStyle}">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding ItemName}" Margin="0,0,4,0" />
                                                            <TextBlock Text="{Binding Status}" FontWeight="Medium" />
                                                        </StackPanel>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                    
                                    <!-- 维修状态 -->
                                    <StackPanel Grid.Column="4" Grid.Row="0" Grid.RowSpan="3" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <Border Style="{StaticResource StatusBadgeStyle}">
                                            <TextBlock Text="{Binding CurrentStage}" />
                                        </Border>
                                    </StackPanel>
                                    
                                    <!-- 预计完成时间 -->
                                    <StackPanel Grid.Column="5" Grid.Row="0" Grid.RowSpan="3" VerticalAlignment="Center" HorizontalAlignment="Right">
                                        <TextBlock Text="预计完成" FontSize="12" Foreground="#6C757D" />
                                        <TextBlock Text="{Binding EstimatedCompletionTime, StringFormat='yyyy-MM-dd HH:mm'}" FontSize="12" />
                                        <TextBlock Text="{Binding Path=Technician, StringFormat='技师：{0}'}" FontSize="12" Foreground="#6C757D" Margin="0,2,0,0" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="车牌号" Width="100" DisplayMemberBinding="{Binding LicensePlate}" />
                            <GridViewColumn Header="客户" Width="120" DisplayMemberBinding="{Binding CustomerName}" />
                            <GridViewColumn Header="接待时间" Width="120" DisplayMemberBinding="{Binding ReceptionDate, StringFormat='yyyy-MM-dd HH:mm'}" />
                            <GridViewColumn Header="维修项目" Width="180" />
                            <GridViewColumn Header="状态" Width="120" DisplayMemberBinding="{Binding CurrentStage}" />
                            <GridViewColumn Header="预计完成" Width="150" DisplayMemberBinding="{Binding EstimatedCompletionTime, StringFormat='yyyy-MM-dd HH:mm'}" />
                        </GridView>
                    </ListView.View>
                </ListView>
            </Border>
        </Grid>
    </Grid>
</UserControl>